$(document).ready(function(){var t=$(".js-add-related-content");$relatedContentForm=$(".js-related-content-form"),$relatedContentContentSection=$(".js-related-content-content"),$relatedContentUrlSection=$(".js-related-content-url-section"),$relatedContentContentId=$(".js-related-content-item-id"),$relatedContentContentDisplayLink=$(".js-related-content-item-display-link"),$relatedContentContentTitle=$(".js-related-content-selected-content"),$relatedContentText=$(".js-related-content-text"),$relatedContentTypes=$(".js-related-content-types"),$relatedContentSaveButton=$(".js-related-content-save-button"),$relatedContentJson=$("#RelatedContent_RelatedContentJson"),$relatedContentsList=$(".js-related-contents-links-list"),$relatedContentsListContainer=$(".js-related-contents-links-list-container"),$relatedContentUnpublishedContent=$(".js-related-content-unpublished-content"),currentContentLinks=[],mode="new",editIndex=0;var e=function(){return $relatedContentContentSection.is(":visible")?$relatedContentContentId.val():0},n=function(){return $relatedContentText.val().trim()},o=function(){var t=!0;""===$relatedContentText.val().trim()&&(t=!1),"-1"===$relatedContentContentId.val()&&(t=!1),$relatedContentUnpublishedContent.is(":visible")===!0&&(t=!1),t===!0?$relatedContentSaveButton.removeClass("disabled"):$relatedContentSaveButton.addClass("disabled")},a=function(){$relatedContentForm.hide(),$relatedContentText.val(""),$relatedContentContentId.val("-1"),$relatedContentContentDisplayLink.val(""),t.show(),$relatedContentContentTitle.html(""),$relatedContentUnpublishedContent.hide(),o()};a();try{currentContentLinks=JSON.parse($relatedContentJson.val())}catch(r){currentContentLinks=[]}t.on("click",function(){mode="new",$relatedContentForm.show(),t.hide()}),$(".js-related-content-cancel-button").on("click",function(){a(),i()}),$(".js-related-content-select-content-btn").on("click",function(){$relatedContentContentId.trigger("orchard-admin-contentpicker-open",{callback:function(t){if($relatedContentContentId.val(t.id),$relatedContentContentTitle.html(t.displayText),"undefined"!=typeof t.displayLink){var e=$(t.displayLink);e.length>0&&(t.displayLink=e.attr("target","_blank")[0].outerHTML)}$relatedContentContentDisplayLink.val(t.displayLink),$relatedContentText.val(t.displayText),t.displayLink.indexOf("Contents/Item/Display/"+t.id)>=0?$relatedContentUnpublishedContent.show():$relatedContentUnpublishedContent.hide(),o()},types:$relatedContentTypes.val(),baseUrl:"/"})}),$(".js-related-content-text").on("keyup",o),$relatedContentSaveButton.on("click",function(){if(!$relatedContentSaveButton.hasClass("disabled")){var t={};if("new"===mode){t={ContentItemId:e(),Label:n()},currentContentLinks.push(t);var o='<li class="last"><div class="summary"><div class="properties"><h3>'+t.Label+"</h3> - ";o+=0!==t.ContentItemId?$relatedContentContentDisplayLink.val():"<a href="+t.Url+' target="_blank">'+t.Url+"</a>",o+='</div><div class="related"><a href="#" data-index="'+(currentContentLinks.length-1)+'" class="js-edit-related-content">Edit</a> | <a href="#" data-index="'+(currentContentLinks.length-1)+'" class="js-remove-related-content">Delete</a></div></div></li>',$relatedContentsList.children().removeClass("last"),$relatedContentsList.append(o)}else{for(var r=$relatedContentsList.find("[data-index="+editIndex+"]").parents("li"),s=-1,C=0;C<currentContentLinks.length;C++)currentContentLinks[C].Label===r.find("h3").text()&&(s=C);currentContentLinks[s].ContentItemId=e(),currentContentLinks[s].Label=n();var c=r.find(".properties");c.find("h3").text(currentContentLinks[s].Label),c.find("a").remove(),c.append($relatedContentContentDisplayLink.val()),i()}$relatedContentJson.val(JSON.stringify(currentContentLinks)),$relatedContentsListContainer.show(),$(".js-remove-related-content").on("click",l),$(".js-edit-related-content").on("click",d),a()}});var l=function(){for(var t=$(this).attr("data-index"),e=$relatedContentsList.find("[data-index="+t+"]").parents("li"),n=-1,o=0;o<currentContentLinks.length;o++)currentContentLinks[o].Label===e.find("h3").text()&&(n=o);return n>-1&&currentContentLinks.splice(n,1),e.remove(),$relatedContentJson.val(JSON.stringify(currentContentLinks)),0===currentContentLinks.length&&$relatedContentsListContainer.hide(),!1},d=function(){i(),mode="edit";for(var e=$(this).attr("data-index"),n=$relatedContentsList.find("[data-index="+e+"]").parents("li"),a=-1,r=0;r<currentContentLinks.length;r++)currentContentLinks[r].Label===n.find("h3").text()&&(a=r);n.hide(),editIndex=a,$relatedContentForm.show(),t.hide();var l=n.find(".properties");return $relatedContentText.val(l.find("h3").text()),$relatedContentContentId.val(currentContentLinks[a].ContentItemId),$relatedContentContentTitle.text(l.find("a").text()),$relatedContentContentDisplayLink.val(l.find("a")[0].outerHTML),o(),!1},i=function(){$(".js-related-contents-links-list > li").show()};$(".js-remove-related-content").on("click",l),$(".js-edit-related-content").on("click",d)});